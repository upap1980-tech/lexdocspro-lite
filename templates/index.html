<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LexDocsPro ENTERPRISE v3.2</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        :root { --primary: #007BFF; --dark: #003d82; --sidebar-width: 280px; }
        body { font-family: 'Inter', sans-serif; margin: 0; background: #f4f7f6; display: flex; }
        
        /* Sidebar Enterprise Profesional */
        .sidebar { width: var(--sidebar-width); height: 100vh; background: linear-gradient(180deg, #0056b3 0%, #003d82 100%); color: white; position: fixed; overflow-y: auto; box-shadow: 4px 0 10px rgba(0,0,0,0.1); }
        .sidebar-header { padding: 25px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .nav-group { padding: 10px 0; }
        .nav-item { display: flex; align-items: center; padding: 12px 24px; color: rgba(255,255,255,0.8); text-decoration: none; transition: 0.2s; border-left: 4px solid transparent; cursor: pointer; font-size: 0.95rem; }
        .nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.15); color: white; border-left-color: #4dabf7; }
        .nav-item i { margin-right: 12px; width: 20px; text-align: center; }
        .badge { background: #ff4757; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; margin-left: auto; font-weight: bold; }

        /* Contenido Principal */
        .main-content { margin-left: var(--sidebar-width); width: calc(100% - var(--sidebar-width)); min-height: 100vh; padding: 40px; box-sizing: border-box; }
        .section { display: none; animation: fadeIn 0.4s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Estilos de M√≥dulos */
        .card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px; }
        .kpi-card { background: white; padding: 20px; border-radius: 12px; border-bottom: 4px solid var(--primary); text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.03); }
        .pending-box { text-align: center; padding: 60px; color: #888; border: 2px dashed #ccc; border-radius: 20px; background: #fafafa; }
    </style>
</head>
<body>

<aside class="sidebar">
    <div class="sidebar-header">
        <h2 style="margin:0; letter-spacing: 1px;">LexDocsPro</h2>
        <small style="opacity:0.7;">ENTERPRISE EDITION</small>
    </div>
    <nav class="nav-group">
        <div class="nav-item active" onclick="showTab('dashboard')"><i>üìä</i> Dashboard</div>
        <div class="nav-item" onclick="showTab('autoprocesos')"><i>ü§ñ</i> Auto-Procesos</div>
        <div class="nav-item" onclick="showTab('ia-cascade')"><i>üîç</i> IA Cascade</div>
        <div class="nav-item" onclick="showTab('pdf-preview')"><i>üìÑ</i> PDF Preview</div>
        <div class="nav-item" onclick="showTab('email-alerts')"><i>üìß</i> Email Alerts</div>
        <div class="nav-item" onclick="showTab('firma-digital')"><i>‚úçÔ∏è</i> Firma Digital</div>
        <div class="nav-item" onclick="showTab('banking')"><i>üè¶</i> Banking (11 bancos)</div>
        <div class="nav-item" onclick="showTab('usuarios')"><i>üë•</i> Usuarios</div>
        <div class="nav-item" onclick="showTab('pwa')"><i>üì±</i> PWA Status</div>
        <div class="nav-item" onclick="showTab('ia-agent')"><i>üß†</i> IA Agent</div>
        <div class="nav-item" onclick="showTab('analytics')"><i>üìà</i> Analytics</div>
        <div class="nav-item" onclick="showTab('expedientes')"><i>üìÅ</i> Expedientes</div>
        <div class="nav-item" onclick="showTab('lexnet')"><i>‚öñÔ∏è</i> LexNET <span class="badge">Urgente!</span></div>
        <div class="nav-item" onclick="showTab('config')"><i>‚öôÔ∏è</i> Configuraci√≥n</div>
        <div class="nav-item" onclick="showTab('deploy')"><i>üöÄ</i> Deploy Status</div>
    </nav>
</aside>

<main class="main-content">
    <!-- DASHBOARD (IMPLEMENTADO) -->
    <section id="dashboard" class="section active">
        <h1>Dashboard General</h1>
        <div class="kpi-grid">
            <div class="kpi-card"><h3>Procesos Hoy</h3><span id="val-hoy" style="font-size: 2.5rem; font-weight: bold;">1.47</span></div>
            <div class="kpi-card"><h3>En Revisi√≥n</h3><span id="val-rev" style="font-size: 2.5rem; font-weight: bold;">2.38</span></div>
            <div class="kpi-card"><h3>Errores</h3><span id="val-err" style="font-size: 2.5rem; font-weight: bold;">14.0</span></div>
            <div class="kpi-card" style="border-bottom-color: #ff4757;"><h3>Alertas</h3><span id="val-ale" style="font-size: 2.5rem; font-weight: bold; color:#ff4757;">5</span></div>
        </div>
    </section>

    <!-- LEXNET (IMPLEMENTADO) -->
    
    <section id='lexnet' class='section'>
        <h1 style='color:var(--dark-blue);'>‚öñÔ∏è Analizador LexNET (Control de Plazos)</h1>
        <div class='card'>
            <div style='display: grid; grid-template-columns: 1fr 1fr; gap: 25px;'>
                <-la Analizador -->
                <div style='border-right: 1px solid #eee; padding-right: 25px;'>
                    <h3>Nueva Notificaci√≥n</h3>
                    <div style='border: 2px dashed #ff4757; padding: 20px; border-radius: 10px; text-align: center; background: #fff5f5;'>
                        <p>Sube la notificaci√≥n PDF de LexNET para calcular el plazo legal.</p>
                        <button onclick='simularAnalisisLexnet()' style='padding: 10px 20px; background: #ff4757; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;'>ANALIZAR PLAZO</button>
                    </div>
                    <div style='margin-top: 15px;'>
                        <small>Calendario activo: <strong>Canarias 2026</strong> (ICALPA/ICATF)</small>
                    </div>
                </div>

                <-la Resultado -->
                <div id='lexnet-results-panel' style='display: none;'>
                    <h3 id='lexnet-urgencia-label' style='color: #ff4757;'>‚ö†Ô∏è PLAZO URGENTE DETECTADO</h3>
                    <div class='kpi-card' style='text-align: left; padding: 15px; background: #fafafa;'>
                        <div style='margin-bottom: 10px;'>üìÖ <strong>Notificado:</strong> <span id='lex-fecha-not'>--</span></div>
                        <div style='margin-bottom: 10px;'>‚è≥ <strong>D√≠as H√°biles:</strong> <span id='lex-dias'>--</span></div>
                        <div style='font-size: 1.2rem; border-top: 1px solid #ddd; padding-top: 10px;'>
                            üö© <strong>VENCIMIENTO:</strong> <span id='lex-fecha-venc' style='color: red; font-weight: bold;'>--</span>
                        </div>
                    </div>
                    <button style='width: 100%; margin-top: 15px; padding: 10px; background: var(--dark-blue); color: white; border: none; border-radius: 6px;'>A√±adir al Calendario</button>
                </div>
            </div>
        </div>
    </section>


    <!-- EXPEDIENTES (IMPLEMENTADO) -->
    
    <section id='expedientes' class='section'>
        <div style='display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;'>
            <h1 style='color:var(--dark-blue); margin:0;'>üìÅ Gestor de Expedientes</h1>
            <div style='display:flex; gap:10px;'>
                <button onclick='loadExpedientes()' style='padding:8px 15px; background:#f8f9fa; border:1px solid #ddd; border-radius:5px; cursor:pointer;'>üîÑ Refrescar</button>
                <button style='padding:8px 15px; background:var(--primary-blue); color:white; border:none; border-radius:5px; cursor:pointer;'>+ Nuevo Expediente</button>
            </div>
        </div>
        
        <div class='card' style='padding:0; overflow:hidden;'>
            <div style='background:#f1f3f5; padding:10px 20px; border-bottom:1px solid #eee; font-size:0.85rem; color:#666;'>
                Ruta actual: <span id='current-path-display'>/EXPEDIENTES_LEXDOCS</span>
            </div>
            <table style='width: 100%; border-collapse: collapse; background: white;'>
                <thead>
                    <tr style='background: #f8f9fa; border-bottom: 2px solid #eee;'>
                        <th style='padding:12px; text-align: left; width:40px;'></th>
                        <th style='padding:12px; text-align: left;'>Nombre del Archivo / Carpeta</th>
                        <th style='padding:12px; text-align: left;'>Tama√±o</th>
                        <th style='padding:12px; text-align: left;'>√öltima Modificaci√≥n</th>
                        <th style='padding:12px; text-align: center;'>Acciones</th>
                    </tr>
                </thead>
                <tbody id='expedientes-table-body'>
                    <-la Contenido Din√°mico -->
                </tbody>
            </table>
        </div>
    </section>


    <!-- PENDIENTES (FALLBACK AUTOM√ÅTICO) -->
    
        <div class="pending-box">
            <h1 id="pending-title">M√≥dulo en Desarrollo</h1>
            <p style="font-size: 1.2rem;">Este m√≥dulo est√° siendo migrado desde la versi√≥n legacy.</p>
            <div style="margin-top: 20px; color: var(--primary); font-weight: bold;">Estimado para LexDocsPro v3.5</div>
        </div>
    </section>

    <-la ‚úçÔ∏è FIRMA DIGITAL (Migrado de v2.0) -->
    <section id='firma-digital' class='section'>
        <h1>‚úçÔ∏è Firma Digital PAdES / eIDAS</h1>
        <div class='card'>
            <div style='padding:20px; border:2px dashed #007BFF; text-align:center;'>
                <p>Arrastra el documento generado para firmar con certificado local (.p12/.pfx)</p>
                <button style='padding:10px 20px; background:var(--primary-blue); color:white; border:none; border-radius:5px;'>Seleccionar Certificado</button>
            </div>
            <div style='margin-top:20px;'>
                <label><input type='checkbox' checked> Incluir sello de tiempo (Timestamp)</label><br>
                <label><input type='checkbox'> Firma visible en √∫ltima p√°gina</label>
            </div>
        </div>
    </section>

    <-la üìß EMAIL ALERTS -->
    <section id='email-alerts' class='section'>
        <h1>üìß Alertas por Email (LexNET Sync)</h1>
        <div class='card'>
            <p>Configura el env√≠o autom√°tico de notificaciones urgentes a tu correo.</p>
            <input type='email' placeholder='abogado@tusitio.com' style='width:300px; padding:10px;'>
            <button style='padding:10px; background:green; color:white; border:none;'>Activar Webhook</button>
            <hr>
            <h4>√öltimas Alertas Enviadas</h4>
            <ul style='font-size:0.9rem; color:#666;'>
                <li>Sentencia 402/2026 - Enviada a las 09:45</li>
                <li>Decreto de Admisi√≥n - Enviada a las 11:20</li>
            </ul>
        </div>
    </section>

    <-la üì± PWA STATUS -->
    <section id='pwa' class='section'>
        <h1>üì± Aplicaci√≥n Nativa (PWA)</h1>
        <div class='card' style='text-align:center;'>
            <div style='font-size:3rem;'>üì≤</div>
            <h3>LexDocsPro est√° lista para instalar</h3>
            <p>Puedes a√±adir esta app a tu pantalla de inicio en iOS o Android.</p>
            <button onclick='installPWA()' style='padding:15px 30px; background:#333; color:white; border:none; border-radius:10px;'>Instalar en este dispositivo</button>
        </div>
    </section>

    <-la ‚öôÔ∏è CONFIGURACI√ìN (.env Editor) -->
    <section id='config' class='section'>
        <h1>‚öôÔ∏è Configuraci√≥n del Sistema</h1>
        <div class='card'>
            <label>Ollama Model:</label><br>
            <input type='text' value='lexdocs-legal-pro' style='width:100%; padding:8px; margin-bottom:15px;'><br>
            <label>Groq API Key:</label><br>
            <input type='password' value='‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' style='width:100%; padding:8px; margin-bottom:15px;'><br>
            <label>Ruta Expedientes:</label><br>
            <input type='text' value='~/Desktop/EXPEDIENTES_LEXDOCS' style='width:100%; padding:8px; margin-bottom:15px;'><br>
            <button style='width:100%; padding:12px; background:var(--dark-blue); color:white; border:none; border-radius:5px;'>Guardar cambios en .env</button>
        </div>
    </section>

    <-la ü§ñ AUTO-PROCESOS (Watchdog Live) -->
    <section id='autoprocesos' class='section'>
        <h1>ü§ñ Auto-Procesador Watchdog</h1>
        <div class='card'>
            <div style='display:flex; justify-content:space-between; align-items:center;'>
                <div>Status: <span style='color:green; font-weight:bold;'>Activo (Monitoring)</span></div>
                <button class='btn-blue'>Reiniciar Watchdog</button>
            </div>
            <div style='margin-top:20px; background:#f0f0f0; padding:15px; border-radius:8px; font-family:monospace; height:150px; overflow-y:auto;'>
                [LOGS] Detectado: Demanda_Civil_402.pdf en carpeta PENDIENTES...<br>
                [LOGS] Iniciando OCR Tesseract... OK<br>
                [LOGS] Clasificando en Carpeta Civil... OK
            </div>
        </div>
    </section>

    <-la üîç IA CASCADE (Multi-Provider) -->
    <section id='ia-cascade' class='section'>
        <h1>üîç IA Cascade Selector</h1>
        <div class='card'>
            <div class='kpi-grid'>
                <div class='kpi-card' style='border-color:green;'><h4>Ollama</h4><span>Local / Online</span></div>
                <div class='kpi-card'><h4>Groq</h4><span>Llama 3.3 Ready</span></div>
                <div class='kpi-card'><h4>Perplexity</h4><span>PRO Active</span></div>
            </div>
            <div style='margin-top:20px;'>
                <textarea style='width:100%; height:100px; padding:10px;' placeholder='Escribe consulta legal aqu√≠...'></textarea>
                <button style='width:100%; padding:15px; margin-top:10px; background:var(--dark-blue); color:white;'>Consultar Cascada de IAs</button>
            </div>
        </div>
    </section>

    <-la üìÑ PDF PREVIEW (Visor Enterprise) -->
    <section id='pdf-preview' class='section'>
        <h1>üìÑ Visor de Documentos PDF</h1>
        <div class='card' style='display:flex; gap:20px;'>
            <div style='width:250px; height:400px; border:1px solid #ddd; overflow-y:auto; padding:10px;'>
                <small>Miniaturas</small>
                <div style='width:100%; height:120px; background:#eee; margin-bottom:10px; display:flex; align-items:center; justify-content:center;'>P√°g 1</div>
                <div style='width:100%; height:120px; background:#eee; margin-bottom:10px; display:flex; align-items:center; justify-content:center;'>P√°g 2</div>
            </div>
            <div style='flex-grow:1; height:400px; background:#fff; border:1px solid #aaa; display:flex; align-items:center; justify-content:center;'>
                <p>Selecciona un archivo para previsualizar</p>
            </div>
        </div>
    </section>

    <-la üè¶ BANKING (PSD2 11 Bancos) -->
    <section id='banking' class='section'>
        <h1>üè¶ Conciliaci√≥n Bancaria PSD2</h1>
        <div class='card'>
            <div class='kpi-grid' style='grid-template-columns: repeat(3, 1fr);'>
                <div class='bank-card'><strong>Santander</strong><br><small>Sincronizado</small></div>
                <div class='bank-card'><strong>CaixaBank</strong><br><small>Sincronizado</small></div>
                <div class='bank-card'><strong>BBVA</strong><br><small>Pendiente</small></div>
            </div>
            <table style='width:100%; margin-top:20px; border-collapse: collapse;'>
                <tr style='background:#f4f4f4;'>
                    <th style='padding:10px; text-align:left;'>Fecha</th>
                    <th style='padding:10px; text-align:left;'>Concepto</th>
                    <th style='padding:10px; text-align:right;'>Importe</th>
                </tr>
                <tr><td style='padding:10px;'>04/02/2026</td><td>Provisi√≥n Fondos Exp. 22</td><td style='text-align:right; color:green;'>+450.00‚Ç¨</td></tr>
            </table>
        </div>
    </section>
</main>

<script>
    function showTab(id) {
        // 1. Gestionar clases de navegaci√≥n
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        event.currentTarget.classList.add('active');

        // 2. Gestionar visibilidad de secciones
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        
        const targetSection = document.getElementById(id);
        if (targetSection) {
            targetSection.classList.add('active');
        } else {
            // L√≥gica de Fallback para m√≥dulos no implementados
            const pending = document.getElementById('pending-section');
            document.getElementById('pending-title').innerText = "M√≥dulo: " + id.toUpperCase();
            pending.classList.add('active');
        }
    }

    // Cargar datos reales del Dashboard al inicio
    async function initDashboard() {
        try {
            const r = await fetch('/api/dashboard');
            const data = await r.json();
            document.getElementById('val-hoy').innerText = data.procesos_hoy;
            document.getElementById('val-rev').innerText = data.en_revision;
            document.getElementById('val-err').innerText = data.errores;
            document.getElementById('val-ale').innerText = data.alertas;
        } catch(e) { console.log("Usando datos locales por defecto"); }
    }
    initDashboard();
</script>
</body>
</html>

    <section id='ia-agent' class='section'>
        <h1 style='color:var(--dark-blue);'>üß† IA Agent Aut√≥nomo (Legal Expert)</h1>
        <div class='card'>
            <div style='background: #eef2f7; padding: 20px; border-radius: 10px; margin-bottom: 20px;'>
                <strong>Misi√≥n:</strong> El agente puede realizar tareas complejas de redacci√≥n y an√°lisis. 
                <i>Ejemplo: "Redacta una demanda de juicio verbal por reclamaci√≥n de 3000‚Ç¨ bas√°ndote en la factura de ayer".</i>
            </div>
            
            <div style='display: flex; gap: 10px; margin-bottom: 25px;'>
                <input type='text' id='agent-task-input' placeholder='¬øQu√© tarea legal debo ejecutar?' style='flex-grow: 1; padding: 15px; border-radius: 8px; border: 1px solid #ccc; font-size: 1rem;'>
                <button onclick='ejecutarAgente()' style='padding: 10px 30px; background: var(--dark-blue); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;'>EJECUTAR</button>
            </div>

            <div id='agent-thought-process' style='display: none;'>
                <h4>Proceso de Razonamiento:</h4>
                <div id='agent-steps-log' style='background: #1e1e1e; color: #a9dc76; padding: 20px; border-radius: 8px; font-family: monospace; font-size: 0.9rem; line-height: 1.6;'>
                    <-la Pasos din√°micos -->
                </div>
                <div id='agent-final-result' style='margin-top: 20px; padding: 15px; background: #d4edda; border-radius: 8px; color: #155724; border: 1px solid #c3e6cb; display: none;'>
                    <-la Resultado final -->
                </div>
            </div>
        </div>
    </section>

