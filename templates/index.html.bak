<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LexDocsPro ENTERPRISE v3.2</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        :root {
            --primary: #007BFF;
            --dark: #003d82;
            --sidebar-width: 280px;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f4f7f6;
            display: flex;
            overflow-x: hidden;
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* SIDEBAR ENTERPRISE */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            background: linear-gradient(180deg, #0056b3 0%, #003d82 100%);
            color: white;
            position: fixed;
            overflow-y: auto;
            box-shadow: 4px 0 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        .sidebar-header {
            padding: 25px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .sidebar-header h2 {
            margin: 0;
            letter-spacing: 1px;
            font-size: 1.5rem;
        }
        
        .sidebar-header small {
            opacity: 0.7;
            display: block;
            margin-top: 5px;
        }
        
        .nav-group {
            padding: 10px 0;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 24px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: 0.2s;
            border-left: 4px solid transparent;
            cursor: pointer;
            font-size: 0.95rem;
        }
        
        .nav-item:hover,
        .nav-item.active {
            background: rgba(255,255,255,0.15);
            color: white;
            border-left-color: #4dabf7;
        }
        
        .nav-item i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
        }
        
        .badge {
            background: #ff4757;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            margin-left: auto;
            font-weight: bold;
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* CONTENIDO PRINCIPAL */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .main-content {
            margin-left: var(--sidebar-width);
            width: calc(100% - var(--sidebar-width));
            min-height: 100vh;
            padding: 40px;
        }
        
        .section {
            display: none;
            animation: fadeIn 0.4s ease;
        }
        
        .section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* KPI CARDS */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .kpi-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            border-bottom: 4px solid var(--primary);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }
        
        .kpi-card h3 {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .kpi-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #333;
            display: block;
        }
        
        .kpi-card.success { border-bottom-color: var(--success); }
        .kpi-card.warning { border-bottom-color: var(--warning); }
        .kpi-card.danger { border-bottom-color: var(--danger); }
        .kpi-card.info { border-bottom-color: var(--info); }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* GRÃFICOS */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .chart-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        
        .chart-card h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.1rem;
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* MÃ“DULOS PLACEHOLDER */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .module-placeholder {
            background: white;
            padding: 60px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        
        .module-placeholder h2 {
            color: #666;
            margin-bottom: 15px;
        }
        
        .module-placeholder p {
            color: #999;
            font-size: 1.1rem;
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* RESPONSIVE */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        @media (max-width: 768px) {
            .sidebar {
                width: 80px;
            }
            
            .sidebar-header h2,
            .sidebar-header small,
            .nav-item span {
                display: none;
            }
            
            .main-content {
                margin-left: 80px;
                width: calc(100% - 80px);
                padding: 20px;
            }
            
            .kpi-grid {
                grid-template-columns: 1fr;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- SIDEBAR -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>LexDocsPro</h2>
            <small>ENTERPRISE v3.2</small>
        </div>
        
        <nav class="nav-group">
            <div class="nav-item active" onclick="showTab('dashboard')">
                <i>ğŸ“Š</i> <span>Dashboard</span>
            </div>
            <div class="nav-item" onclick="showTab('autoprocesos')">
                <i>ğŸ¤–</i> <span>Auto-Procesos</span>
            </div>
            <div class="nav-item" onclick="showTab('ia-cascade')">
                <i>ğŸ”</i> <span>IA Cascade</span>
            </div>
            <div class="nav-item" onclick="showTab('pdf-preview')">
                <i>ğŸ“„</i> <span>PDF Preview</span>
            </div>
            <div class="nav-item" onclick="showTab('email-alerts')">
                <i>ğŸ“§</i> <span>Email Alerts</span>
            </div>
            <div class="nav-item" onclick="showTab('firma-digital')">
                <i>âœï¸</i> <span>Firma Digital</span>
            </div>
            <div class="nav-item" onclick="showTab('banking')">
                <i>ğŸ¦</i> <span>Banking (11 bancos)</span>
            </div>
            <div class="nav-item" onclick="showTab('usuarios')">
                <i>ğŸ‘¥</i> <span>Usuarios</span>
            </div>
            <div class="nav-item" onclick="showTab('pwa')">
                <i>ğŸ“±</i> <span>PWA Status</span>
            </div>
            <div class="nav-item" onclick="showTab('ia-agent')">
                <i>ğŸ§ </i> <span>IA Agent</span>
            </div>
            <div class="nav-item" onclick="showTab('analytics')">
                <i>ğŸ“ˆ</i> <span>Analytics</span>
            </div>
            <div class="nav-item" onclick="showTab('expedientes')">
                <i>ğŸ“</i> <span>Expedientes</span>
            </div>
            <div class="nav-item" onclick="showTab('lexnet')">
                <i>âš–ï¸</i> <span>LexNET</span>
                <span class="badge">2</span>
            </div>
            <div class="nav-item" onclick="showTab('config')">
                <i>âš™ï¸</i> <span>ConfiguraciÃ³n</span>
            </div>
            <div class="nav-item" onclick="showTab('deploy')">
                <i>ğŸš€</i> <span>Deploy Status</span>
            </div>
        </nav>
    </aside>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- CONTENIDO PRINCIPAL -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <main class="main-content">
        <!-- â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ -->
        <!-- DASHBOARD -->
        <!-- â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ -->
        <section id="dashboard" class="section active">
            <h1 style="margin-bottom: 30px; color: #333;">Dashboard General</h1>
            
            <!-- KPIs -->
            <div class="kpi-grid">
                <div class="kpi-card success">
                    <h3>Procesos Hoy</h3>
                    <span class="kpi-value" id="val-hoy">0</span>
                </div>
                <div class="kpi-card info">
                    <h3>En RevisiÃ³n</h3>
                    <span class="kpi-value" id="val-rev">0</span>
                </div>
                <div class="kpi-card warning">
                    <h3>Errores</h3>
                    <span class="kpi-value" id="val-err">0</span>
                </div>
                <div class="kpi-card danger">
                    <h3>Alertas</h3>
                    <span class="kpi-value" id="val-ale">0</span>
                </div>
            </div>
            
            <!-- GrÃ¡ficos -->
            <div class="charts-grid">
                <div class="chart-card">
                    <h3>Documentos Procesados (Ãšltimos 7 dÃ­as)</h3>
                    <canvas id="chart-docs"></canvas>
                </div>
                <div class="chart-card">
                    <h3>DistribuciÃ³n por Tipo</h3>
                    <canvas id="chart-tipos"></canvas>
                </div>
            </div>
        </section>

        <!-- â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ -->
        <!-- OTROS MÃ“DULOS (PLACEHOLDERS) -->
        <!-- â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ -->
                        <section id="autoprocesos" class="section">
            <h1 style="margin-bottom: 30px; color: #333;">ğŸ¤– Auto-Procesos</h1>
            
            <!-- Control Panel -->
            <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px;">
                <h3 style="margin-bottom: 20px;">Panel de Control</h3>
                
                <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                    <button onclick="startAutoProcessor()" style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">
                        â–¶ï¸ INICIAR
                    </button>
                    <button onclick="stopAutoProcessor()" style="padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">
                        â¸ï¸ DETENER
                    </button>
                    <button onclick="scanFiles()" style="padding: 10px 20px; background: #007BFF; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">
                        ğŸ” ESCANEAR
                    </button>
                    <button onclick="loadAutoProcessorStatus()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">
                        ğŸ”„ ACTUALIZAR
                    </button>
                </div>
                
                <div id="auto-status" style="padding: 15px; background: #f8f9fa; border-radius: 6px; font-family: monospace;">
                    <p>ğŸ”„ Cargando estado...</p>
                </div>
            </div>
            
            <!-- EstadÃ­sticas -->
            <div class="kpi-grid">
                <div class="kpi-card success">
                    <h3>Procesados</h3>
                    <span class="kpi-value" id="auto-processed">0</span>
                </div>
                <div class="kpi-card warning">
                    <h3>En Cola</h3>
                    <span class="kpi-value" id="auto-pending">0</span>
                </div>
                <div class="kpi-card danger">
                    <h3>Errores</h3>
                    <span class="kpi-value" id="auto-errors">0</span>
                </div>
                <div class="kpi-card info">
                    <h3>Estado</h3>
                    <span class="kpi-value" id="auto-running" style="font-size: 1.5rem;">â¸ï¸</span>
                </div>
            </div>
            
            <!-- Cola de Procesamiento -->
            <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-top: 20px;">
                <h3 style="margin-bottom: 15px;">Cola de Procesamiento</h3>
                <div id="processing-queue" style="max-height: 300px; overflow-y: auto;">
                    <p style="color: #999; text-align: center; padding: 40px;">Cargando...</p>
                </div>
            </div>

            <!-- Historial de Procesamiento -->
            <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-top: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3>Historial de Procesamiento</h3>
                    <button onclick="loadProcessingLog()" style="padding: 8px 15px; background: #007BFF; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        ğŸ”„ Actualizar
                    </button>
                </div>
                <div id="processing-log" style="overflow-x: auto;">
                    <p style="color: #999; text-align: center; padding: 40px;">Cargando historial...</p>
                </div>
            </div>
        </section>
        
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             IA CASCADE SECTION v3.0 - Multi-Provider Dashboard
             â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <section id="ia-cascade" class="section">
            <h1 style="margin-bottom: 30px; color: #333;">ğŸ¤– IA Cascade - Multi-Provider Dashboard</h1>
            
            <!-- Stats Globales -->
            <div class="cascade-global-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <h3 style="font-size: 2em; margin: 0 0 10px 0;" id="cascade-total-calls">0</h3>
                    <p style="margin: 0; font-size: 0.9em; opacity: 0.9;">Total Llamadas</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #38b2ac 0%, #2c7a7b 100%); color: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <h3 style="font-size: 2em; margin: 0 0 10px 0;" id="cascade-success-calls">0</h3>
                    <p style="margin: 0; font-size: 0.9em; opacity: 0.9;">Ã‰xitos</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #fc8181 0%, #e53e3e 100%); color: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <h3 style="font-size: 2em; margin: 0 0 10px 0;" id="cascade-failed-calls">0</h3>
                    <p style="margin: 0; font-size: 0.9em; opacity: 0.9;">Fallos</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #f6ad55 0%, #dd6b20 100%); color: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <h3 style="font-size: 2em; margin: 0 0 10px 0;" id="cascade-avg-uptime">0%</h3>
                    <p style="margin: 0; font-size: 0.9em; opacity: 0.9;">Uptime Promedio</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #48bb78 0%, #2f855a 100%); color: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <h3 style="font-size: 2em; margin: 0 0 10px 0;" id="cascade-enabled-providers">0</h3>
                    <p style="margin: 0; font-size: 0.9em; opacity: 0.9;">Providers Activos</p>
                </div>
            </div>
            
            <!-- Tabla de Providers -->
            <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 30px;">
                <h3 style="margin-bottom: 20px;">ğŸ“Š Providers Configurados</h3>
                
                <div style="overflow-x: auto;">
                    <table id="providers-table" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #2c3e50; color: white;">
                                <th style="padding: 15px 10px; text-align: left; font-weight: 600; font-size: 0.9em;">Prioridad</th>
                                <th style="padding: 15px 10px; text-align: left; font-weight: 600; font-size: 0.9em;">Provider</th>
                                <th style="padding: 15px 10px; text-align: left; font-weight: 600; font-size: 0.9em;">Modelo</th>
                                <th style="padding: 15px 10px; text-align: left; font-weight: 600; font-size: 0.9em;">Estado</th>
                                <th style="padding: 15px 10px; text-align: left; font-weight: 600; font-size: 0.9em;">Llamadas</th>
                                <th style="padding: 15px 10px; text-align: left; font-weight: 600; font-size: 0.9em;">Ã‰xitos</th>
                                <th style="padding: 15px 10px; text-align: left; font-weight: 600; font-size: 0.9em;">Fallos</th>
                                <th style="padding: 15px 10px; text-align: left; font-weight: 600; font-size: 0.9em;">Tiempo Promedio</th>
                                <th style="padding: 15px 10px; text-align: left; font-weight: 600; font-size: 0.9em;">Uptime</th>
                                <th style="padding: 15px 10px; text-align: left; font-weight: 600; font-size: 0.9em;">API Key</th>
                                <th style="padding: 15px 10px; text-align: left; font-weight: 600; font-size: 0.9em;">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="providers-tbody">
                            <tr>
                                <td colspan="11" style="padding: 40px; text-align: center; color: #999;">
                                    ğŸ”„ Cargando providers...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Test Area -->
            <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 30px;">
                <h3 style="margin-bottom: 20px;">ğŸ§ª Test de Providers</h3>
                
                <div style="display: grid; grid-template-columns: 1fr auto; gap: 20px; margin-bottom: 20px;">
                    <label style="display: flex; flex-direction: column; gap: 8px;">
                        <strong>Provider:</strong>
                        <select id="test-provider" style="padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 1em;">
                            <option value="cascade">ğŸ”„ Cascade AutomÃ¡tico (Fallback)</option>
                            <option value="ollama">Ollama (Local)</option>
                            <option value="groq">Groq Cloud</option>
                            <option value="perplexity">Perplexity AI</option>
                            <option value="openai">OpenAI GPT-4</option>
                            <option value="gemini">Google Gemini</option>
                            <option value="deepseek">DeepSeek</option>
                            <option value="claude">Anthropic Claude</option>
                        </select>
                    </label>
                    
                    <label style="display: flex; flex-direction: column; gap: 8px;">
                        <strong>Temperature: <span id="temp-value">0.3</span></strong>
                        <input type="range" id="test-temperature" min="0" max="1" step="0.1" value="0.3" style="padding: 10px;">
                    </label>
                </div>
                
                <label style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px;">
                    <strong>Prompt de Prueba:</strong>
                    <textarea id="test-prompt-input" rows="4" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-family: 'Courier New', monospace; font-size: 0.95em; resize: vertical;" placeholder="Escribe tu pregunta aquÃ­...">Â¿QuÃ© es el artÃ­culo 133 de la LEC?</textarea>
                </label>
                
                <button id="btn-test-cascade" onclick="testIACascade()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 30px; border-radius: 6px; font-size: 1em; font-weight: 600; cursor: pointer; transition: transform 0.2s;">
                    ğŸš€ Ejecutar Test
                </button>
                
                <!-- Resultado -->
                <div id="test-result" style="display: none; margin-top: 20px; padding: 20px; background: #f0fff4; border: 1px solid #9ae6b4; border-radius: 8px; animation: fadeIn 0.3s;">
                    <h4 style="margin-top: 0;">ğŸ“„ Resultado:</h4>
                    <div class="result-meta" style="display: flex; gap: 20px; margin-bottom: 15px; flex-wrap: wrap; font-size: 0.9em; color: #4a5568;">
                        <span>ğŸ¤– Provider: <strong id="result-provider"></strong></span>
                        <span>â±ï¸ Tiempo: <strong id="result-time"></strong></span>
                        <span>ğŸ“Š Tokens: <strong id="result-tokens"></strong></span>
                    </div>
                    <div class="result-content">
                        <pre id="result-text" style="background: #2d3748; color: #e2e8f0; padding: 15px; border-radius: 6px; overflow-x: auto; font-family: 'Courier New', monospace; font-size: 0.9em; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;"></pre>
                    </div>
                </div>
                
                <!-- Error -->
                <div id="test-error" style="display: none; margin-top: 20px; padding: 20px; background: #fff5f5; border: 1px solid #fc8181; border-radius: 8px; animation: fadeIn 0.3s;">
                    <h4 style="margin-top: 0; color: #e53e3e;">âŒ Error:</h4>
                    <pre id="error-text" style="background: #2d3748; color: #fc8181; padding: 15px; border-radius: 6px; overflow-x: auto; font-family: 'Courier New', monospace; font-size: 0.9em; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;"></pre>
                </div>
            </div>
            
            <!-- Botones de GestiÃ³n -->
            <div style="display: flex; gap: 15px; margin-top: 30px; flex-wrap: wrap;">
                <button onclick="refreshCascadeStats()" style="padding: 10px 20px; border: 1px solid #ddd; border-radius: 6px; background: white; cursor: pointer; transition: all 0.2s; font-size: 0.95em;">
                    ğŸ”„ Refrescar Stats
                </button>
                <button onclick="resetCascadeStats()" style="padding: 10px 20px; border: 1px solid #ddd; border-radius: 6px; background: white; cursor: pointer; transition: all 0.2s; font-size: 0.95em;">
                    ğŸ—‘ï¸ Resetear Stats
                </button>
                <button onclick="exportCascadeStats()" style="padding: 10px 20px; border: 1px solid #ddd; border-radius: 6px; background: white; cursor: pointer; transition: all 0.2s; font-size: 0.95em;">
                    ğŸ“¥ Exportar Stats (JSON)
                </button>
            </div>
        </section>

        <!-- Modal para Actualizar API Keys -->
        <div id="api-key-modal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; justify-content: center; align-items: center;">
            <div class="modal-content" style="background: white; padding: 30px; border-radius: 12px; max-width: 500px; width: 90%; box-shadow: 0 10px 25px rgba(0,0,0,0.3);">
                <h3 style="margin-top: 0;">ğŸ”‘ Actualizar API Key</h3>
                <p style="margin-bottom: 20px;">Provider: <strong id="modal-provider-name"></strong></p>
                
                <label style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px;">
                    <strong>API Key:</strong>
                    <input type="password" id="modal-api-key-input" placeholder="Ingresa la API key" style="padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-family: 'Courier New', monospace; font-size: 0.95em;">
                </label>
                
                <div class="modal-buttons" style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button onclick="saveAPIKey()" style="padding: 10px 20px; border: none; border-radius: 6px; background: #48bb78; color: white; cursor: pointer; font-size: 0.95em; font-weight: 600;">
                        ğŸ’¾ Guardar
                    </button>
                    <button onclick="closeAPIKeyModal()" style="padding: 10px 20px; border: none; border-radius: 6px; background: #e53e3e; color: white; cursor: pointer; font-size: 0.95em; font-weight: 600;">
                        âŒ Cancelar
                    </button>
                </div>
            </div>
        </div>

        <!-- Estilos adicionales para animaciones -->
        <style>
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #providers-table tbody tr:hover {
            background: #f0f8ff !important;
        }

        #providers-table tbody tr.provider-enabled {
            background: #f8fff8;
        }

        #providers-table tbody tr.provider-disabled {
            background: #fff8f8;
            opacity: 0.7;
        }

        #btn-test-cascade:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        #btn-test-cascade:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .modal.visible {
            display: flex !important;
        }

        /* Loading Spinner */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #fff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Uptime Bar */
        .uptime-bar {
            width: 100%;
            height: 24px;
            background: #ecf0f1;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }

        .uptime-fill {
            height: 100%;
            background: linear-gradient(90deg, #56ab2f 0%, #a8e063 100%);
            transition: width 0.3s ease;
        }

        .uptime-bar span {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.8em;
            font-weight: 600;
            color: #2c3e50;
        }

        /* Status Badges */
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-enabled {
            background: #d4edda;
            color: #155724;
        }

        .status-disabled {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85em;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85em;
        }

        /* Actions Cell */
        .actions-cell {
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        .btn-icon {
            background: none;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .btn-icon:hover {
            background: rgba(0,0,0,0.05);
        }
        </style>




        <section id="pdf-preview" class="section">
            <div class="module-placeholder">
                <h2>ğŸ“„ PDF Preview</h2>
                <p>Visor Enterprise en desarrollo</p>
            </div>
        </section>

        <section id="email-alerts" class="section">
            <div class="module-placeholder">
                <h2>ğŸ“§ Email Alerts</h2>
                <p>Sistema de notificaciones configurado</p>
            </div>
        </section>

        <section id="firma-digital" class="section">
            <div class="module-placeholder">
                <h2>âœï¸ Firma Digital</h2>
                <p>Migrado de v2.0</p>
            </div>
        </section>

        <section id="banking" class="section">
            <div class="module-placeholder">
                <h2>ğŸ¦ Banking</h2>
                <p>PSD2 - 11 bancos integrados</p>
            </div>
        </section>

        <section id="usuarios" class="section">
            <div class="module-placeholder">
                <h2>ğŸ‘¥ Usuarios</h2>
                <p>GestiÃ³n de usuarios y roles</p>
            </div>
        </section>

        <section id="pwa" class="section">
            <div class="module-placeholder">
                <h2>ğŸ“± PWA Status</h2>
                <p>Progressive Web App activa</p>
            </div>
        </section>

        <section id="ia-agent" class="section">
            <div class="module-placeholder">
                <h2>ğŸ§  IA Agent</h2>
                <p>Agente inteligente con feedback loop</p>
            </div>
        </section>

        <section id="analytics" class="section">
            <div class="module-placeholder">
                <h2>ğŸ“ˆ Analytics</h2>
                <p>Estimado para v3.5</p>
            </div>
        </section>

        <section id="expedientes" class="section">
            <div class="module-placeholder">
                <h2>ğŸ“ Expedientes</h2>
                <p>Gestor de expedientes legales</p>
            </div>
        </section>

        <section id="lexnet" class="section">
            <div class="module-placeholder">
                <h2>âš–ï¸ LexNET</h2>
                <p>Analizador de notificaciones automÃ¡tico</p>
            </div>
        </section>

        <section id="config" class="section">
            <div class="module-placeholder">
                <h2>âš™ï¸ ConfiguraciÃ³n</h2>
                <p>Editor .env y configuraciÃ³n del sistema</p>
            </div>
        </section>

        <section id="deploy" class="section">
            <div class="module-placeholder">
                <h2>ğŸš€ Deploy Status</h2>
                <p>Estado del despliegue y logs</p>
            </div>
        </section>
    </main>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- JavaScript principal -->
    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // NAVEGACIÃ“N ENTRE TABS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function showTab(tabName) {
            // Ocultar todas las secciones
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Desactivar todos los nav-items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Mostrar secciÃ³n seleccionada
            document.getElementById(tabName).classList.add('active');
            
            // Activar nav-item correspondiente
            event.target.closest('.nav-item').classList.add('active');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CARGAR DATOS DEL DASHBOARD
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function loadDashboardStats() {
            try {
                const response = await fetch('/api/dashboard/stats', {
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    // Actualizar KPIs
                    document.getElementById('val-hoy').textContent = data.procesos_hoy || 0;
                    document.getElementById('val-rev').textContent = data.en_revision || 0;
                    document.getElementById('val-err').textContent = data.errores || 0;
                    document.getElementById('val-ale').textContent = data.alertas || 0;
                    
                    console.log('âœ… Dashboard stats cargados:', data);
                    
                    // Inicializar grÃ¡ficos
                    initCharts();
                }
            } catch (error) {
                console.error('âŒ Error cargando dashboard:', error);
                // Mantener valores por defecto (0)
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // GRÃFICOS CON CHART.JS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function initCharts() {
            // GrÃ¡fico de lÃ­nea - Documentos por dÃ­a
            const ctxDocs = document.getElementById('chart-docs').getContext('2d');
            new Chart(ctxDocs, {
                type: 'line',
                data: {
                    labels: ['Lun', 'Mar', 'MiÃ©', 'Jue', 'Vie', 'SÃ¡b', 'Dom'],
                    datasets: [{
                        label: 'Documentos Procesados',
                        data: [12, 19, 15, 25, 22, 18, 20],
                        borderColor: '#007BFF',
                        backgroundColor: 'rgba(0, 123, 255, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // GrÃ¡fico de dona - Tipos de documento
            const ctxTipos = document.getElementById('chart-tipos').getContext('2d');
            new Chart(ctxTipos, {
                type: 'doughnut',
                data: {
                    labels: ['Contratos', 'Demandas', 'Escrituras', 'Otros'],
                    datasets: [{
                        data: [35, 25, 20, 20],
                        backgroundColor: [
                            '#007BFF',
                            '#28a745',
                            '#ffc107',
                            '#dc3545'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true
                }
            });
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // INICIALIZACIÃ“N
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸš€ LexDocsPro Enterprise v3.2 iniciado');
            loadDashboardStats();
            
            // Recargar stats cada 30 segundos
            setInterval(loadDashboardStats, 30000);
        });
    
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // AUTO-PROCESSOR FUNCTIONS (ÃšNICA VERSIÃ“N)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function loadAutoProcessorStatus() {
            fetch('/api/autoprocessor/status')
                .then(function(response) { return response.json(); })
                .then(function(data) {
                    if (data.success && data.status) {
                        var s = data.status;
                        
                        // KPIs
                        document.getElementById('auto-processed').textContent = s.stats.processed || 0;
                        document.getElementById('auto-pending').textContent = s.queue || 0;
                        document.getElementById('auto-errors').textContent = s.stats.errors || 0;
                        document.getElementById('auto-running').textContent = s.running ? 'â–¶ï¸' : 'â¸ï¸';
                        
                        // Panel
                        document.getElementById('auto-status').innerHTML = 
                            '<p><strong>Estado:</strong> ' + (s.running ? 'ğŸŸ¢ ACTIVO' : 'ğŸ”´ DETENIDO') + '</p>' +
                            '<p><strong>Carpeta:</strong> ' + s.watch_dir + '</p>' +
                            '<p><strong>Procesados:</strong> ' + (s.stats.processed||0) + '</p>' +
                            '<p><strong>En Cola:</strong> ' + (s.queue||0) + '</p>';
                        
                        // Cola
                        var queueHTML = '<p style="color:#999;text-align:center;padding:40px">âœ… No hay archivos</p>';
                        if (s.queue_items && s.queue_items.length > 0) {
                            queueHTML = s.queue_items.map(function(item) {
                                return '<div style="padding:10px;border-bottom:1px solid #eee">' + 
                                       '<strong>' + item.file.split('/').pop() + '</strong>' +
                                       '<span style="float:right;color:#999">' + item.status + '</span>' +
                                       '</div>';
                            }).join('');
                        }
                        document.getElementById('processing-queue').innerHTML = queueHTML;
                        
                        console.log('âœ… Status actualizado');
                    }
                })
                .catch(function(error) {
                    console.error('âŒ Error:', error);
                    document.getElementById('auto-status').innerHTML = 
                        '<p style="color:#dc3545">âŒ Error: ' + error.message + '</p>';
                });
        }
        
        function startAutoProcessor() {
            fetch('/api/autoprocessor/start', {method:'POST'})
                .then(function(r) { return r.json(); })
                .then(function(d) { 
                    alert(d.message); 
                    loadAutoProcessorStatus(); 
                })
                .catch(function(e) { alert('Error: ' + e.message); });
        }
        
        function stopAutoProcessor() {
            fetch('/api/autoprocessor/stop', {method:'POST'})
                .then(function(r) { return r.json(); })
                .then(function(d) { 
                    alert(d.message); 
                    loadAutoProcessorStatus(); 
                })
                .catch(function(e) { alert('Error: ' + e.message); });
        }
        
        function scanFiles() {
            if (!confirm('Â¿Escanear archivos en PENDIENTES?')) return;
            
            fetch('/api/autoprocessor/scan', {method:'POST'})
                .then(function(r) { return r.json(); })
                .then(function(d) { 
                    alert(d.message); 
                    loadAutoProcessorStatus(); 
                })
                .catch(function(e) { alert('Error: ' + e.message); });
        }
        
        // Auto-actualizar cada 5 segundos si el tab estÃ¡ activo
        setInterval(function() {
            var section = document.getElementById('autoprocesos');
            if (section && section.classList.contains('active')) {
                loadAutoProcessorStatus();
            }
        }, 5000);

    
        // IA CASCADE FUNCTIONS
        function loadIACascadeStatus() {
            fetch('/api/ia-cascade/status')
                .then(r => r.json())
                .then(data => {
                    if (data.success) {
                        const status = data.status;
                        
                        // Stats globales
                        document.getElementById('ia-total').textContent = status.global_stats.total_requests;
                        document.getElementById('ia-success').textContent = status.global_stats.successful;
                        document.getElementById('ia-failed').textContent = status.global_stats.failed;
                        
                        // Providers
                        const providersHTML = status.providers.map(p => `
                            <div style="background: white; padding: 20px; border-radius: 8px; border-left: 4px solid ${p.available ? '#28a745' : '#dc3545'};">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <strong style="font-size: 1.1rem;">${p.name}</strong>
                                        <div style="color: #666; font-size: 0.9rem; margin-top: 5px;">${p.model}</div>
                                        <div style="color: #999; font-size: 0.8rem;">Prioridad: ${p.priority}</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 1.5rem;">${p.available ? 'ğŸŸ¢' : 'ğŸ”´'}</div>
                                        <div style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                                            ${p.stats.success} / ${p.stats.requests}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('');
                        
                        document.getElementById('ia-providers').innerHTML = providersHTML;
                    }
                })
                .catch(e => console.error(e));
        }
        
        function testIACascade() {
            const prompt = document.getElementById('ia-prompt').value;
            if (!prompt.trim()) {
                alert('Escribe un prompt primero');
                return;
            }
            
            document.getElementById('ia-response').style.display = 'block';
            document.getElementById('ia-response-text').textContent = 'â³ Procesando...';
            
            fetch('/api/ia-cascade/query', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({prompt: prompt})
            })
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('ia-response-text').textContent = 
                        `[${data.provider} - ${data.model}]

${data.response}`;
                    loadIACascadeStatus();
                } else {
                    document.getElementById('ia-response-text').textContent = 
                        `âŒ Error: ${data.error}`;
                }
            })
            .catch(e => {
                document.getElementById('ia-response-text').textContent = 
                    `âŒ Error: ${e.message}`;
            });
        }
        
        // Cargar al abrir tab
        const origShowTab2 = window.showTab;
        window.showTab = function(tab) {
            origShowTab2(tab);
            if (tab === 'ia-cascade') {
                loadIACascadeStatus();
            }
        };

    
        function loadProcessingLog() {
            fetch('/api/autoprocessor/log?limit=20')
                .then(r => r.json())
                .then(data => {
                    if (data.success && data.log && data.log.length > 0) {
                        const logHTML = `
                            <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                                <thead>
                                    <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                        <th style="padding: 10px; text-align: left;">Archivo</th>
                                        <th style="padding: 10px; text-align: center;">Estado</th>
                                        <th style="padding: 10px; text-align: center;">OCR</th>
                                        <th style="padding: 10px; text-align: center;">Tiempo</th>
                                        <th style="padding: 10px; text-align: left;">Fecha</th>
                                        <th style="padding: 10px; text-align: center;">Rutas</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.log.map(item => `
                                        <tr style="border-bottom: 1px solid #eee;">
                                            <td style="padding: 10px; max-width: 200px; overflow: hidden; text-overflow: ellipsis;" title="${item.filename}">
                                                ${item.filename}
                                            </td>
                                            <td style="padding: 10px; text-align: center;">
                                                <span style="padding: 4px 8px; border-radius: 4px; background: ${item.status === 'SUCCESS' ? '#d4edda' : '#f8d7da'}; color: ${item.status === 'SUCCESS' ? '#155724' : '#721c24'}; font-size: 0.8rem; font-weight: bold;">
                                                    ${item.status}
                                                </span>
                                            </td>
                                            <td style="padding: 10px; text-align: center;">
                                                ${item.ocr_chars ? item.ocr_chars + ' chars' : '-'}
                                            </td>
                                            <td style="padding: 10px; text-align: center;">
                                                ${item.processing_time ? item.processing_time.toFixed(2) + 's' : '-'}
                                            </td>
                                            <td style="padding: 10px; font-size: 0.85rem; color: #666;">
                                                ${item.completed_at ? new Date(item.completed_at).toLocaleString('es-ES') : '-'}
                                            </td>
                                            <td style="padding: 10px; text-align: center;">
                                                <button onclick="showFilePaths('${item.filename}', '${item.backup_path}', '${item.final_path}')" style="padding: 4px 8px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">
                                                    ğŸ“‚ Ver
                                                </button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        `;
                        
                        document.getElementById('processing-log').innerHTML = logHTML;
                    } else {
                        document.getElementById('processing-log').innerHTML = 
                            '<p style="color: #999; text-align: center; padding: 40px;">No hay registros en el historial</p>';
                    }
                })
                .catch(e => {
                    console.error('Error cargando log:', e);
                    document.getElementById('processing-log').innerHTML = 
                        '<p style="color: #dc3545; text-align: center; padding: 40px;">âŒ Error cargando historial</p>';
                });
        }
        
        function showFilePaths(filename, backup, final) {
            alert('ğŸ“‚ Trazabilidad de: ' + filename + '\n\n' +
                  'ğŸ’¾ Backup:\n' + backup + '\n\n' +
                  'âœ… Final:\n' + final);
        }
        
        // Cargar log cuando se abre el tab
        const origShowTab3 = window.showTab;
        window.showTab = function(tab) {
            origShowTab3(tab);
            if (tab === 'autoprocesos') {
                loadAutoProcessorStatus();
                loadProcessingLog();
            }
        };

    </script>

    <script>
        
        
        );
                
                const data = await response.json();
                
                if (data.success) {
                    const status = data.status;
                    
                    // Actualizar KPIs
                    document.getElementById('auto-processed').textContent = status.stats.processed;
                    document.getElementById('auto-pending').textContent = status.queue;
                    document.getElementById('auto-errors').textContent = status.stats.errors;
                    document.getElementById('auto-running').textContent = status.running ? 'â–¶ï¸' : 'â¸ï¸';
                    
                    // Actualizar panel de estado
                    const statusDiv = document.getElementById('auto-status');
                    statusDiv.innerHTML = `
                        <p><strong>Estado:</strong> ${status.running ? 'ğŸŸ¢ ACTIVO' : 'ğŸ”´ DETENIDO'}</p>
                        <p><strong>Carpeta:</strong> ${status.watch_dir}</p>
                        <p><strong>Procesados:</strong> ${status.stats.processed}</p>
                        <p><strong>Errores:</strong> ${status.stats.errors}</p>
                        <p><strong>En Cola:</strong> ${status.queue}</p>
                        <p><strong>Ãšltimo:</strong> ${status.stats.last_processed || 'N/A'}</p>
                        <p><strong>Inicio:</strong> ${status.stats.start_time || 'N/A'}</p>
                    `;
                    
                    // Actualizar cola
                    const queueDiv = document.getElementById('processing-queue');
                    if (status.queue_items && status.queue_items.length > 0) {
                        queueDiv.innerHTML = status.queue_items.map(item => `
                            <div style="padding: 10px; border-bottom: 1px solid #eee;">
                                <strong>${item.file.split('/').pop()}</strong>
                                <span style="color: #999; float: right;">${item.status}</span>
                            </div>
                        `).join('');
                    } else {
                        queueDiv.innerHTML = '<p style="color: #999; text-align: center; padding: 40px;">No hay archivos en cola</p>';
                    }
                    
                    console.log('âœ… Auto-processor status actualizado');
                }
            } catch (error) {
                console.error('âŒ Error cargando auto-processor status:', error);
            }
        }
        
        );
                
                const data = await response.json();
                alert(data.message);
            } catch (error) {
                alert('Error iniciando auto-processor');
                console.error(error);
            }
        }
        
        );
                
                const data = await response.json();
                alert(data.message);
            } catch (error) {
                alert('Error deteniendo auto-processor');
                console.error(error);
            }
        }
        
        
            
            try {
                const response = await fetch('/api/autoprocessor/scan', {
                    method: 'POST',
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert(`âœ… ${data.processed} archivos procesados`);
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                alert('Error escaneando archivos');
                console.error(error);
            }
        }
        
        // Auto-actualizar cada 5 segundos si el tab estÃ¡ activo
        
    
        
        );
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                console.log('ğŸ“¦ Status recibido:', data);
                
                if (data.success && data.status) {
                    const status = data.status;
                    
                    // Actualizar KPIs
                    document.getElementById('auto-processed').textContent = status.stats.processed || 0;
                    document.getElementById('auto-pending').textContent = status.queue || 0;
                    document.getElementById('auto-errors').textContent = status.stats.errors || 0;
                    document.getElementById('auto-running').textContent = status.running ? 'â–¶ï¸' : 'â¸ï¸';
                    
                    // Actualizar panel de estado
                    const statusDiv = document.getElementById('auto-status');
                    statusDiv.innerHTML = `
                        <p><strong>Estado:</strong> ${status.running ? 'ğŸŸ¢ ACTIVO' : 'ğŸ”´ DETENIDO'}</p>
                        <p><strong>Carpeta:</strong> ${status.watch_dir}</p>
                        <p><strong>Procesados:</strong> ${status.stats.processed || 0}</p>
                        <p><strong>Errores:</strong> ${status.stats.errors || 0}</p>
                        <p><strong>En Cola:</strong> ${status.queue || 0}</p>
                        <p><strong>Ãšltimo:</strong> ${status.stats.last_processed || 'N/A'}</p>
                        <p><strong>Iniciado:</strong> ${status.stats.start_time ? new Date(status.stats.start_time).toLocaleString('es-ES') : 'N/A'}</p>
                    `;
                    
                    // Actualizar cola
                    const queueDiv = document.getElementById('processing-queue');
                    if (status.queue_items && status.queue_items.length > 0) {
                        queueDiv.innerHTML = status.queue_items.map(item => `
                            <div style="padding: 10px; border-bottom: 1px solid #eee;">
                                <strong>${item.file.split('/').pop()}</strong>
                                <span style="color: #999; float: right;">${item.status}</span>
                                <br><small style="color: #999;">${item.added_at}</small>
                            </div>
                        `).join('');
                    } else {
                        queueDiv.innerHTML = '<p style="color: #999; text-align: center; padding: 40px;">âœ… No hay archivos en cola</p>';
                    }
                    
                    console.log('âœ… Status actualizado correctamente');
                } else {
                    console.warn('âš ï¸ Status sin success o data.status');
                    throw new Error(data.error || 'Respuesta invÃ¡lida');
                }
                
            } catch (error) {
                console.error('âŒ Error cargando status:', error);
                
                const statusDiv = document.getElementById('auto-status');
                if (statusDiv) {
                    statusDiv.innerHTML = `
                        <p style="color: #dc3545;">âŒ Error: ${error.message}</p>
                        <p style="font-size: 0.8rem; color: #999;">Verifica que el servidor estÃ© corriendo</p>
                    `;
                }
            }
        }
        
        async 
        )
            .then(response => {
                if (!response.ok) throw new Error('HTTP ' + response.status);
                return response.json();
            })
            .then(data => {
                console.log('ğŸ“¦ Status recibido:', data);
                
                if (data.success && data.status) {
                    const status = data.status;
                    
                    // Actualizar KPIs
                    document.getElementById('auto-processed').textContent = status.stats.processed || 0;
                    document.getElementById('auto-pending').textContent = status.queue || 0;
                    document.getElementById('auto-errors').textContent = status.stats.errors || 0;
                    document.getElementById('auto-running').textContent = status.running ? 'â–¶ï¸' : 'â¸ï¸';
                    
                    // Actualizar panel de estado
                    const statusDiv = document.getElementById('auto-status');
                    statusDiv.innerHTML = 
                        '<p><strong>Estado:</strong> ' + (status.running ? 'ğŸŸ¢ ACTIVO' : 'ğŸ”´ DETENIDO') + '</p>' +
                        '<p><strong>Carpeta:</strong> ' + status.watch_dir + '</p>' +
                        '<p><strong>Procesados:</strong> ' + (status.stats.processed || 0) + '</p>' +
                        '<p><strong>Errores:</strong> ' + (status.stats.errors || 0) + '</p>' +
                        '<p><strong>En Cola:</strong> ' + (status.queue || 0) + '</p>' +
                        '<p><strong>Ãšltimo:</strong> ' + (status.stats.last_processed || 'N/A') + '</p>' +
                        '<p><strong>Iniciado:</strong> ' + (status.stats.start_time || 'N/A') + '</p>';
                    
                    // Actualizar cola
                    const queueDiv = document.getElementById('processing-queue');
                    if (status.queue_items && status.queue_items.length > 0) {
                        queueDiv.innerHTML = status.queue_items.map(function(item) {
                            return '<div style="padding: 10px; border-bottom: 1px solid #eee;">' +
                                   '<strong>' + item.file.split('/').pop() + '</strong>' +
                                   '<span style="color: #999; float: right;">' + item.status + '</span>' +
                                   '</div>';
                        }).join('');
                    } else {
                        queueDiv.innerHTML = '<p style="color: #999; text-align: center; padding: 40px;">âœ… No hay archivos en cola</p>';
                    }
                    
                    console.log('âœ… Status actualizado correctamente');
                } else {
                    throw new Error(data.error || 'Respuesta invÃ¡lida');
                }
            })
            .catch(function(error) {
                console.error('âŒ Error:', error);
                const statusDiv = document.getElementById('auto-status');
                if (statusDiv) {
                    statusDiv.innerHTML = '<p style="color: #dc3545;">âŒ Error: ' + error.message + '</p>' +
                                         '<p style="font-size: 0.8rem; color: #999;">Verifica que el servidor estÃ© corriendo</p>';
                }
            });
        }

        );
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                console.log('ğŸ“¦ Respuesta start:', data);
                
                if (data.success) {
                    alert(data.message || 'âœ… Auto-procesador iniciado');
                } else {
                    alert('âŒ Error: ' + (data.error || 'Error desconocido'));
                }
                
            } catch (error) {
                console.error('âŒ Error:', error);
                alert('âŒ Error iniciando auto-processor:
' + error.message);
            }
        }
        
        );
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                console.log('ğŸ“¦ Respuesta stop:', data);
                
                if (data.success) {
                    alert(data.message || 'ğŸ›‘ Auto-procesador detenido');
                } else {
                    alert('âŒ Error: ' + (data.error || 'Error desconocido'));
                }
                
            } catch (error) {
                console.error('âŒ Error:', error);
                alert('âŒ Error deteniendo auto-processor:
' + error.message);
            }
        }
        
        
            
            try {
                console.log('ğŸ” Escaneando archivos...');
                
                const response = await fetch('/api/autoprocessor/scan', {
                    method: 'POST',
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                console.log('ğŸ“¦ Respuesta scan:', data);
                
                if (data.success) {
                    const msg = data.message || `âœ… ${data.processed} archivo(s) procesados`;
                    alert(msg);
                } else {
                    alert('âŒ Error: ' + (data.error || 'Error desconocido'));
                }
                
            } catch (error) {
                console.error('âŒ Error:', error);
                alert('âŒ Error escaneando archivos:
' + error.message);
            }
        }
        
        // Auto-actualizar cuando el tab estÃ¡ activo
        let autoProcessorInterval = null;
        
        
        )
            .then(response => {
                if (!response.ok) throw new Error('HTTP ' + response.status);
                return response.json();
            })
            .then(data => {
                console.log('ğŸ“¦ Status recibido:', data);
                
                if (data.success && data.status) {
                    const status = data.status;
                    
                    // Actualizar KPIs
                    document.getElementById('auto-processed').textContent = status.stats.processed || 0;
                    document.getElementById('auto-pending').textContent = status.queue || 0;
                    document.getElementById('auto-errors').textContent = status.stats.errors || 0;
                    document.getElementById('auto-running').textContent = status.running ? 'â–¶ï¸' : 'â¸ï¸';
                    
                    // Actualizar panel de estado
                    const statusDiv = document.getElementById('auto-status');
                    statusDiv.innerHTML = 
                        '<p><strong>Estado:</strong> ' + (status.running ? 'ğŸŸ¢ ACTIVO' : 'ğŸ”´ DETENIDO') + '</p>' +
                        '<p><strong>Carpeta:</strong> ' + status.watch_dir + '</p>' +
                        '<p><strong>Procesados:</strong> ' + (status.stats.processed || 0) + '</p>' +
                        '<p><strong>Errores:</strong> ' + (status.stats.errors || 0) + '</p>' +
                        '<p><strong>En Cola:</strong> ' + (status.queue || 0) + '</p>' +
                        '<p><strong>Ãšltimo:</strong> ' + (status.stats.last_processed || 'N/A') + '</p>' +
                        '<p><strong>Iniciado:</strong> ' + (status.stats.start_time || 'N/A') + '</p>';
                    
                    // Actualizar cola
                    const queueDiv = document.getElementById('processing-queue');
                    if (status.queue_items && status.queue_items.length > 0) {
                        queueDiv.innerHTML = status.queue_items.map(function(item) {
                            return '<div style="padding: 10px; border-bottom: 1px solid #eee;">' +
                                   '<strong>' + item.file.split('/').pop() + '</strong>' +
                                   '<span style="color: #999; float: right;">' + item.status + '</span>' +
                                   '</div>';
                        }).join('');
                    } else {
                        queueDiv.innerHTML = '<p style="color: #999; text-align: center; padding: 40px;">âœ… No hay archivos en cola</p>';
                    }
                    
                    console.log('âœ… Status actualizado correctamente');
                } else {
                    throw new Error(data.error || 'Respuesta invÃ¡lida');
                }
            })
            .catch(function(error) {
                console.error('âŒ Error:', error);
                const statusDiv = document.getElementById('auto-status');
                if (statusDiv) {
                    statusDiv.innerHTML = '<p style="color: #dc3545;">âŒ Error: ' + error.message + '</p>' +
                                         '<p style="font-size: 0.8rem; color: #999;">Verifica que el servidor estÃ© corriendo</p>';
                }
            });
        }

            
            autoProcessorInterval = setInterval(() => {
                const section = document.getElementById('autoprocesos');
                if (section && section.classList.contains('active')) {
                }
            }, 5000);
        }
        
        // Iniciar polling cuando se carga el mÃ³dulo
        const originalShowTab = window.showTab;
        window.showTab = function(tabName) {
            originalShowTab(tabName);
            
            if (tabName === 'autoprocesos') {
                startAutoProcessorPolling();
            }
        };

    
